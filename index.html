<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Global Hygiene Dashboard</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; }
    .chart { width: 80%; height: 400px; margin: 40px auto; }
  </style>
</head>
<body>
  <h1>Global Average Hygiene Coverage Over Time</h1>
  <div id="ts" class="chart"></div>
  <script>
    const num = x => +x;
    Plotly.d3.csv(
      "https://raw.githubusercontent.com/Divij/Divij-BAA1030/main/unicef_indicator_1.csv",
      function(err, rows) {
        const hygiene = rows.filter(r =>
          r.indicator ===
            "Proportion of health care facilities with basic hygiene services"
        );
        const byYear = {};
        hygiene.forEach(r => {
          const y = num(r.time_period);
          (byYear[y] = byYear[y] || []).push(num(r.obs_value));
        });
        const years = Object.keys(byYear).map(Number).sort((a,b)=>a-b);
        const avgs = years.map(y =>
          byYear[y].reduce((a,b)=>a+b,0) / byYear[y].length
        );
        Plotly.newPlot("ts", [{
          x: years,
          y: avgs,
          mode: "lines+markers",
          marker: { size: 6 },
          line: { width: 2 }
        }], {
          xaxis: { title: "Year" },
          yaxis: { title: "Avg Hygiene (%)", range: [0,100] },
          margin: { t:40, b:40, l:60, r:20 }
        });
      }
    );
  </script>
  <h2>Top 10 Countries by Hygiene Coverage (Latest Year)</h2>
  <div id="bar1" class="chart"></div>
  <script>
    const num = x => +x;
    Plotly.d3.csv(
      "https://raw.githubusercontent.com/divij786/Divij-BAA1030/main/unicef_indicator_1.csv",
      function(err, rows) {
        // 1. Filter to the hygiene indicator
        const hyg = rows.filter(r =>
          r.indicator ===
            "Proportion of health care facilities with basic hygiene services"
        );
        // 2. Find latest year
        const years = [...new Set(hyg.map(r => num(r.time_period)))];
        const latest = Math.max(...years);
        // 3. Filter to that year
        const latestData = hyg.filter(r => num(r.time_period) === latest);
        // 4. Map country â†’ coverage value
        const byCountry = {};
        latestData.forEach(r => {
          byCountry[r.country] = num(r.obs_value);
        });
        // 5. Sort descending, take top 10
        const sorted = Object.entries(byCountry)
                             .sort((a,b) => b[1] - a[1])
                             .slice(0,10);
        const countries = sorted.map(d => d[0]);
        const values    = sorted.map(d => d[1]);
        // 6. Plot horizontal bar
        Plotly.newPlot("bar1", [{
          x: values,
          y: countries,
          type: "bar",
          orientation: "h",
          marker: { color: "steelblue" }
        }], {
          title: `Top 10 Countries by Hygiene Coverage (${latest})`,
          xaxis: { title: "Coverage (%)", range: [0,100] },
          margin: { l: 150, t: 50, b: 40 }
        });
      }
    );
  </script>
</body>
</html>

